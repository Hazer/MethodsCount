container_commands:
  42_fetch_sdk_index:
    command: |
      /home/webapp/android-sdk-linux/tools/android list sdk --all > indexes.txt
  
  43_fetch_deps:
    command: |
      echo "deps"
      deps=("Android SDK Tools" "Android SDK Platform-tools" "Android SDK Build-tools" "SDK Platform Android 6.0" "SDK Platform Android 5.1.1" "Android Support Repository" "Android Support Library" "Google Play services" "Google Repository")

      export IFS=$'\n'
      idxs=""
      for lib in "${deps[@]}"
      do
        idxs="$idxs,$(grep $lib indexes.txt | sed -e 's/\(\d*\)-.*/\1/g' |  tr -d " \t\r" | head -1)"
      done

      end=$((SECONDS+150)) # give it 2.5 minutes to finish. til a better solution is found

      while [ $SECONDS -lt $end ]; do echo y; sleep 4; done | /home/webapp/android-sdk-linux/tools/android update sdk --no-ui --filter ${idxs:1}

  44_install_gradle_deps:
    command: |
      /var/app/current/gradle_mock_project/gradlew
      cp -rf /root/.gradle /home/webapp

      chmod -R 777 /home/webapp/.gradle
